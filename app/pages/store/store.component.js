"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Created by barney on 2017/6/12.
 */
var core_1 = require("@angular/core");
var store_1 = require("../../shared/store/store"); // 数据模型
var store_home_service_1 = require("../../shared/store/store-home.service");
var page_1 = require("tns-core-modules/ui/page");
var color_1 = require("color");
var router_1 = require("@angular/router");
var StoreComponent = (function () {
    function StoreComponent(storeHomeService, page, router) {
        this.storeHomeService = storeHomeService;
        this.page = page;
        this.router = router;
        this.dataAry = []; // 数据源
        this.filterTitle = ["店铺首页", "全部宝贝", "新品上架", "联系客服"];
        this.selectedIndex = 0;
        this.selectedIndexSmall = 0;
        this.storeName = "";
        this.storeLogo = "";
        this.storeFans = "";
        this.fav = false; // 收藏状态 默认未收藏
        this.allGoodsCount = "";
        this.newCount = "";
        this.allGoodsHidden = false;
        this.allGoodsFilterAry = [];
    }
    StoreComponent.prototype.ngOnInit = function () {
        this.page.backgroundColor = new color_1.Color("#f0f0f0");
        this.getStoreInfo();
        this.getStoreHomeList();
        this.allGoodsFilterAry = ["人气", "销量", "价格", "新品"];
    };
    // 店铺首页列表
    StoreComponent.prototype.getStoreHomeList = function () {
        var _this = this;
        this.storeHomeService.getStoreHomeList({ store_id: "13" }).subscribe(function (json) {
            var ary = [];
            json.goods_data.forEach(function (store) {
                store.data[0].name = store.name; // 向数组的第一个元素添加 name 属性，实现分组效果
                if (!!store.data[1]) {
                    store.data[1].index = false;
                }
                if (store.data.length % 2 !== 0) {
                    store.data.push({}); // 若数组的个数为奇数，则追加一个空的元素，实现换行效果
                }
                store.data.forEach(function (goods) {
                    ary.push(goods); // 把各组的所有元素拼接为一个总的数组
                });
            });
            ary.map(function (goods) {
                new store_1.StoreHomeGoods(goods.goods_current_price, goods.goods_main_photo, goods.goods_name, goods.id, goods.name, null);
            });
            _this.dataAry = ary;
        });
    };
    // 新品上架列表
    StoreComponent.prototype.getNewGoodsList = function () {
        var _this = this;
        this.storeHomeService.getNewGoodsList({ store_id: "12" }).subscribe(function (json) {
            var ary = [];
            json.data.forEach(function (store) {
                store.goods_data[0].date_data = store.date_data; // 向数组的第一个元素添加 name 属性，实现分组效果
                if (store.goods_data.length % 2 !== 0) {
                    store.goods_data.push({}); // 若数组的个数为奇数，则追加一个空的元素，实现换行效果
                }
                store.goods_data.forEach(function (goods) {
                    ary.push(goods); // 把各组的所有元素拼接为一个总的数组
                });
            });
            ary.map(function (goods) {
                new store_1.StoreHomeGoods(goods.goods_current_price, goods.goods_main_photo, goods.goods_name, goods.id, null, goods.date_data);
            });
            _this.dataAry = ary;
        });
    };
    // 全部宝贝列表
    StoreComponent.prototype.getAllGoods = function () {
        var _this = this;
        this.storeHomeService.getAllGoodsList({ store_id: "12" }).subscribe(function (json) {
            var ary = [];
            json.goods_list.forEach(function (store) {
                ary.push(new store_1.StoreHomeGoods(store.goods_current_price, store.goods_main_photo, store.goods_name, store.id, null, null));
            });
            _this.dataAry = ary;
        });
    };
    // 获取店铺信息
    StoreComponent.prototype.getStoreInfo = function () {
        var _this = this;
        this.storeHomeService.getStoreInfo({ store_id: "12" }).subscribe(function (json) {
            //    this.storeInfoModel = new StoreInfo(json.fans_count, json.favourited, json.store_logo, json.store_name, json.new_count, json.all_count);
            _this.storeName = json.store_name;
            _this.storeLogo = json.store_logo;
            _this.storeFans = json.fans_count;
            _this.allGoodsCount = json.all_count;
            _this.newCount = json.new_count;
            if (json.favourited === "0") {
                _this.fav = false;
            }
            else {
                _this.fav = true;
            }
        });
    };
    // 四个大选项点击事件
    StoreComponent.prototype.onTap = function (index) {
        this.selectedIndex = index;
        if (index === 0) {
            this.getStoreHomeList();
            this.allGoodsHidden = false;
        }
        else if (index === 2) {
            this.getNewGoodsList();
            this.allGoodsHidden = false;
        }
        else if (index === 1) {
            this.getAllGoods();
            this.allGoodsHidden = true;
        }
        else if (index === 3) {
            // 跳转联系客服页面
            this.allGoodsHidden = false;
        }
    };
    // 四个小选项点击事件
    StoreComponent.prototype.onTapSmall = function (index) {
        this.selectedIndexSmall = index;
        if (index === 0) {
        }
        else if (index === 1) {
        }
        else if (index === 2) {
        }
        else if (index === 3) {
        }
    };
    // 点击收藏按钮
    StoreComponent.prototype.isFavourite = function () {
        var _this = this;
        this.storeHomeService.isFavourite({ store_id: "12" }).subscribe(function (json) {
            if (json.code === 1) {
                alert("操作失败");
            }
            else if (json.code === 0) {
                if (_this.fav === false) {
                    alert("收藏成功");
                    _this.fav = true;
                }
                else {
                    alert("取消收藏成功");
                    _this.fav = false;
                }
            }
        });
    };
    // 跳转分类页面
    StoreComponent.prototype.jumpClassify = function () {
        // this.router.navigate(["/store-classify"]);
    };
    return StoreComponent;
}());
StoreComponent = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: "store",
        templateUrl: "./store.component.html",
        styleUrls: ["./store-common.css"],
        providers: [store_home_service_1.StoreHomeService],
    }),
    __metadata("design:paramtypes", [store_home_service_1.StoreHomeService, page_1.Page, router_1.Router])
], StoreComponent);
exports.StoreComponent = StoreComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3RvcmUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7O0dBRUc7QUFDSCxzQ0FBa0Q7QUFDbEQsa0RBQXFFLENBQUMsT0FBTztBQUM3RSw0RUFBeUU7QUFDekUsaURBQThDO0FBQzlDLCtCQUE4QjtBQUM5QiwwQ0FBeUM7QUFTekMsSUFBYSxjQUFjO0lBZXZCLHdCQUFvQixnQkFBa0MsRUFBVSxJQUFVLEVBQVUsTUFBYztRQUE5RSxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFkMUYsWUFBTyxHQUFxQixFQUFFLENBQUMsQ0FBQyxNQUFNO1FBQ3RDLGdCQUFXLEdBQUcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMvQyxrQkFBYSxHQUFHLENBQUMsQ0FBQztRQUNsQix1QkFBa0IsR0FBRyxDQUFDLENBQUM7UUFDdkIsY0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNmLGNBQVMsR0FBRyxFQUFFLENBQUM7UUFDZixjQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ2YsUUFBRyxHQUFHLEtBQUssQ0FBQyxDQUFDLGFBQWE7UUFDMUIsa0JBQWEsR0FBRyxFQUFFLENBQUM7UUFDbkIsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNkLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLHNCQUFpQixHQUFHLEVBQUUsQ0FBQztJQUdzRSxDQUFDO0lBQ3RHLGlDQUFRLEdBQVI7UUFDSSxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLGFBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNqRCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDcEIsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDeEIsSUFBSSxDQUFD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QztJQUNkLENBQUM7SUFDRCxTQUFTO0lBQ1QscUNBQVksR0FBWjtRQUNJLDZDQUE2QztJQUNqRCxDQUFDO0lBQ0wscUJBQUM7QUFBRCxDQUFDLEFBN0pELElBNkpDO0FBN0pZLGNBQWM7SUFQMUIsZ0JBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtRQUNuQixRQUFRLEVBQUUsT0FBTztRQUNqQixXQUFXLEVBQUUsd0JBQXdCO1FBQ3JDLFNBQVMsRUFBRSxDQUFDLG9CQUFvQixDQUFDO1FBQ2pDLFNBQVMsRUFBRSxDQUFDLHFDQUFnQixDQUFDO0tBQ2hDLENBQUM7cUNBZ0J3QyxxQ0FBZ0IsRUFBZ0IsV0FBSSxFQUFrQixlQUFNO0dBZnpGLGNBQWMsQ0E2SjFCO0FBN0pZLHdDQUFjIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IGJhcm5leSBvbiAyMDE3LzYvMTIuXG4gKi9cbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IFN0b3JlSG9tZSwgU3RvcmVIb21lR29vZHMgfSBmcm9tIFwiLi4vLi4vc2hhcmVkL3N0b3JlL3N0b3JlXCI7IC8vIOaVsOaNruaooeWei1xuaW1wb3J0IHsgU3RvcmVIb21lU2VydmljZSB9IGZyb20gXCIuLi8uLi9zaGFyZWQvc3RvcmUvc3RvcmUtaG9tZS5zZXJ2aWNlXCI7XG5pbXBvcnQge1BhZ2V9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL3BhZ2VcIjtcbmltcG9ydCB7IENvbG9yIH0gZnJvbSBcImNvbG9yXCI7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tIFwiQGFuZ3VsYXIvcm91dGVyXCI7XG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6IFwic3RvcmVcIixcbiAgICB0ZW1wbGF0ZVVybDogXCIuL3N0b3JlLmNvbXBvbmVudC5odG1sXCIsXG4gICAgc3R5bGVVcmxzOiBbXCIuL3N0b3JlLWNvbW1vbi5jc3NcIl0sXG4gICAgcHJvdmlkZXJzOiBbU3RvcmVIb21lU2VydmljZV0sXG59KVxuZXhwb3J0IGNsYXNzIFN0b3JlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBwcml2YXRlIGRhdGFBcnk6IFN0b3JlSG9tZUdvb2RzW10gPSBbXTsgLy8g5pWw5o2u5rqQXG4gICAgcHJpdmF0ZSBmaWx0ZXJUaXRsZSA9IFtcIuW6l+mTuummlumhtVwiLCBcIuWFqOmDqOWunei0nVwiLCBcIuaWsOWTgeS4iuaetlwiLCBcIuiBlOezu+WuouacjVwiXTtcbiAgICBwcml2YXRlIHNlbGVjdGVkSW5kZXggPSAwO1xuICAgIHByaXZhdGUgc2VsZWN0ZWRJbmRleFNtYWxsID0gMDtcbiAgICBwcml2YXRlIHN0b3JlTmFtZSA9IFwiXCI7XG4gICAgcHJpdmF0ZSBzdG9yZUxvZ28gPSBcIlwiO1xuICAgIHByaXZhdGUgc3RvcmVGYW5zID0gXCJcIjtcbiAgICBwcml2YXRlIGZhdiA9IGZhbHNlOyAvLyDmlLbol4/nirbmgIEg6buY6K6k5pyq5pS26JePXG4gICAgcHJpdmF0ZSBhbGxHb29kc0NvdW50ID0gXCJcIjtcbiAgICBwcml2YXRlIG5ld0NvdW50ID0gXCJcIjtcbiAgICBwcml2YXRlIGFsbEdvb2RzSGlkZGVuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBhbGxHb29kc0ZpbHRlckFyeSA9IFtdO1xuXG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHN0b3JlSG9tZVNlcnZpY2U6IFN0b3JlSG9tZVNlcnZpY2UsIHByaXZhdGUgcGFnZTogUGFnZSwgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcikge31cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5wYWdlLmJhY2tncm91bmRDb2xvciA9IG5ldyBDb2xvcihcIiNmMGYwZjBcIik7XG4gICAgICAgIHRoaXMuZ2V0U3RvcmVJbmZvKCk7XG4gICAgICAgIHRoaXMuZ2V0U3RvcmVIb21lTGlzdCgpO1xuICAgICAgICB0aGlzLmFsbEdvb2RzRmlsdGVyQXJ5ID0gW1wi5Lq65rCUXCIsIFwi6ZSA6YePXCIsIFwi5Lu35qC8XCIsIFwi5paw5ZOBXCJdO1xuICAgIH1cbiAgICAvLyDlupfpk7rpppbpobXliJfooahcbiAgICBnZXRTdG9yZUhvbWVMaXN0KCkge1xuICAgICAgICB0aGlzLnN0b3JlSG9tZVNlcnZpY2UuZ2V0U3RvcmVIb21lTGlzdCh7c3RvcmVfaWQ6IFwiMTNcIn0pLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAgICAgKGpzb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFyeSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAganNvbi5nb29kc19kYXRhLmZvckVhY2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHN0b3JlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUuZGF0YVswXS5uYW1lID0gc3RvcmUubmFtZTsgLy8g5ZCR5pWw57uE55qE56ys5LiA5Liq5YWD57Sg5re75YqgIG5hbWUg5bGe5oCn77yM5a6e546w5YiG57uE5pWI5p6cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEhc3RvcmUuZGF0YVsxXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZS5kYXRhWzFdLmluZGV4ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdG9yZS5kYXRhLmxlbmd0aCAlIDIgIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUuZGF0YS5wdXNoKHt9KTsgLy8g6Iul5pWw57uE55qE5Liq5pWw5Li65aWH5pWw77yM5YiZ6L+95Yqg5LiA5Liq56m655qE5YWD57Sg77yM5a6e546w5o2i6KGM5pWI5p6cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLmRhdGEuZm9yRWFjaCgoZ29vZHMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJ5LnB1c2goZ29vZHMpOyAvLyDmiorlkITnu4TnmoTmiYDmnInlhYPntKDmi7zmjqXkuLrkuIDkuKrmgLvnmoTmlbDnu4RcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyeS5tYXAoKGdvb2RzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFN0b3JlSG9tZUdvb2RzKGdvb2RzLmdvb2RzX2N1cnJlbnRfcHJpY2UsIGdvb2RzLmdvb2RzX21haW5fcGhvdG8sIGdvb2RzLmdvb2RzX25hbWUsIGdvb2RzLmlkLCBnb29kcy5uYW1lLG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFBcnkgPSBhcnk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgIH1cbiAgICAvLyDmlrDlk4HkuIrmnrbliJfooahcbiAgICBnZXROZXdHb29kc0xpc3QoKSB7XG4gICAgICAgIHRoaXMuc3RvcmVIb21lU2VydmljZS5nZXROZXdHb29kc0xpc3Qoe3N0b3JlX2lkOiBcIjEyXCJ9KS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIChqc29uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnkgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpzb24uZGF0YS5mb3JFYWNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdG9yZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLmdvb2RzX2RhdGFbMF0uZGF0ZV9kYXRhID0gc3RvcmUuZGF0ZV9kYXRhOyAvLyDlkJHmlbDnu4TnmoTnrKzkuIDkuKrlhYPntKDmt7vliqAgbmFtZSDlsZ7mgKfvvIzlrp7njrDliIbnu4TmlYjmnpxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RvcmUuZ29vZHNfZGF0YS5sZW5ndGggJSAyICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLmdvb2RzX2RhdGEucHVzaCh7fSk7IC8vIOiLpeaVsOe7hOeahOS4quaVsOS4uuWlh+aVsO+8jOWImei/veWKoOS4gOS4quepuueahOWFg+e0oO+8jOWunueOsOaNouihjOaViOaenFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZS5nb29kc19kYXRhLmZvckVhY2goKGdvb2RzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyeS5wdXNoKGdvb2RzKTsgLy8g5oqK5ZCE57uE55qE5omA5pyJ5YWD57Sg5ou85o6l5Li65LiA5Liq5oC755qE5pWw57uEXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcnkubWFwKChnb29kcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBTdG9yZUhvbWVHb29kcyhnb29kcy5nb29kc19jdXJyZW50X3ByaWNlLCBnb29kcy5nb29kc19tYWluX3Bob3RvLCBnb29kcy5nb29kc19uYW1lLCBnb29kcy5pZCwgbnVsbCwgZ29vZHMuZGF0ZV9kYXRhKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhQXJ5ID0gYXJ5O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICB9XG4gICAgLy8g5YWo6YOo5a6d6LSd5YiX6KGoXG4gICAgZ2V0QWxsR29vZHMoKSB7XG4gICAgICAgIHRoaXMuc3RvcmVIb21lU2VydmljZS5nZXRBbGxHb29kc0xpc3Qoe3N0b3JlX2lkOiBcIjEyXCJ9KS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIChqc29uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnkgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpzb24uZ29vZHNfbGlzdC5mb3JFYWNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdG9yZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyeS5wdXNoKG5ldyBTdG9yZUhvbWVHb29kcyhzdG9yZS5nb29kc19jdXJyZW50X3ByaWNlLCBzdG9yZS5nb29kc19tYWluX3Bob3RvLCBzdG9yZS5nb29kc19uYW1lLCBzdG9yZS5pZCwgbnVsbCwgbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhQXJ5ID0gYXJ5O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICB9XG4gICAgLy8g6I635Y+W5bqX6ZO65L+h5oGvXG4gICAgZ2V0U3RvcmVJbmZvKCkge1xuICAgICAgICB0aGlzLnN0b3JlSG9tZVNlcnZpY2UuZ2V0U3RvcmVJbmZvKHtzdG9yZV9pZDogXCIxMlwifSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICAgICAoanNvbikgPT4geyAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIHRoaXMuc3RvcmVJbmZvTW9kZWwgPSBuZXcgU3RvcmVJbmZvKGpzb24uZmFuc19jb3VudCwganNvbi5mYXZvdXJpdGVkLCBqc29uLnN0b3JlX2xvZ28sIGpzb24uc3RvcmVfbmFtZSwganNvbi5uZXdfY291bnQsIGpzb24uYWxsX2NvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9yZU5hbWUgPSBqc29uLnN0b3JlX25hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVMb2dvID0ganNvbi5zdG9yZV9sb2dvO1xuICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3JlRmFucyA9IGpzb24uZmFuc19jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGxHb29kc0NvdW50ID0ganNvbi5hbGxfY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmV3Q291bnQgPSBqc29uLm5ld19jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb24uZmF2b3VyaXRlZCA9PT0gXCIwXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmF2ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmF2ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICB9XG4gICAgLy8g5Zub5Liq5aSn6YCJ6aG554K55Ye75LqL5Lu2XG4gICAgb25UYXAoaW5kZXgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gaW5kZXg7XG4gICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5nZXRTdG9yZUhvbWVMaXN0KCk7XG4gICAgICAgICAgICB0aGlzLmFsbEdvb2RzSGlkZGVuID0gZmFsc2U7XG4gICAgICAgIH1lbHNlIGlmKGluZGV4ID09PSAyKSB7XG4gICAgICAgICAgICB0aGlzLmdldE5ld0dvb2RzTGlzdCgpO1xuICAgICAgICAgICAgdGhpcy5hbGxHb29kc0hpZGRlbiA9IGZhbHNlO1xuICAgICAgICB9ZWxzZSBpZihpbmRleCA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5nZXRBbGxHb29kcygpO1xuICAgICAgICAgICAgdGhpcy5hbGxHb29kc0hpZGRlbiA9IHRydWU7XG4gICAgICAgIH1lbHNlIGlmKGluZGV4ID09PSAzKSB7XG4gICAgICAgICAgICAvLyDot7PovazogZTns7vlrqLmnI3pobXpnaJcbiAgICAgICAgICAgIHRoaXMuYWxsR29vZHNIaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyDlm5vkuKrlsI/pgInpobnngrnlh7vkuovku7ZcbiAgICBvblRhcFNtYWxsKGluZGV4KSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleFNtYWxsID0gaW5kZXg7XG4gICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgXG4gICAgICAgIH1lbHNlIGlmKGluZGV4ID09PSAxKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgfWVsc2UgaWYoaW5kZXggPT09IDIpIHtcbiAgICAgICAgICAgIFxuICAgICAgICB9ZWxzZSBpZihpbmRleCA9PT0gMykge1xuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8g54K55Ye75pS26JeP5oyJ6ZKuXG4gICAgaXNGYXZvdXJpdGUoKSB7XG4gICAgICAgIHRoaXMuc3RvcmVIb21lU2VydmljZS5pc0Zhdm91cml0ZSh7c3RvcmVfaWQ6IFwiMTJcIn0pLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAgICAgKGpzb24pID0+IHsgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICBpZiAoanNvbi5jb2RlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChcIuaTjeS9nOWksei0pVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoanNvbi5jb2RlID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5mYXYgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCLmlLbol4/miJDlip9cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYXYgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChcIuWPlua2iOaUtuiXj+aIkOWKn1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhdiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgIH1cbiAgICAvLyDot7PovazliIbnsbvpobXpnaJcbiAgICBqdW1wQ2xhc3NpZnkoKSB7XG4gICAgICAgIC8vIHRoaXMucm91dGVyLm5hdmlnYXRlKFtcIi9zdG9yZS1jbGFzc2lmeVwiXSk7XG4gICAgfVxufSJdfQ==