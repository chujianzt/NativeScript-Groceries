/**
 * Created by admin on 2017/6/12.
 */
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var stack_layout_1 = require("tns-core-modules/ui/layouts/stack-layout");
var image_1 = require("tns-core-modules/ui/image");
var Observable_1 = require("rxjs/Observable");
var platform_1 = require("platform");
var enums_1 = require("tns-core-modules/ui/enums");
var ViewPagerComponent = (function () {
    function ViewPagerComponent() {
        this.onPagerChange = new core_1.EventEmitter();
        this.index = 0;
        this.height = 0;
    }
    ViewPagerComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.addData(this.images);
        this.subscribe = Observable_1.Observable.interval(2500).subscribe(function () {
            _this.flip(_this.index + 1);
        });
    };
    ViewPagerComponent.prototype.addData = function (images) {
        var _this = this;
        this.height = platform_1.screen.mainScreen.widthDIPs * 520 / 1080;
        this.viewpager = new stack_layout_1.StackLayout();
        this.viewpager.set("width", platform_1.screen.mainScreen.widthDIPs * this.images.length);
        this.viewpager.set("height", this.height);
        this.viewpager.set("orientation", "horizontal");
        this.barContainer = new stack_layout_1.StackLayout();
        this.barContainer.set("width", 20 * images.length);
        this.barContainer.set("height", 20);
        this.barContainer.set("orientation", "horizontal");
        this.barContainer.set("left", (platform_1.screen.mainScreen.widthDIPs - 20 * images.length) / 2);
        this.barContainer.set("top", this.height - 30);
        images.forEach(function (url, i) {
            var image = new image_1.Image();
            image.set("src", url);
            image.set("width", platform_1.screen.mainScreen.widthDIPs);
            image.set("height", _this.height);
            _this.viewpager.addChild(image);
            var lab = new image_1.Image();
            lab.set("width", 10);
            lab.set("height", 10);
            lab.set("borderRadius", 10);
            lab.set("margin", 5);
            if (i === 0) {
                lab.set("backgroundColor", "#ffffff");
            }
            else {
                lab.set("backgroundColor", "#44000000");
            }
            _this.barContainer.addChild(lab);
        });
        var absoluteLayout = this.container.nativeElement;
        absoluteLayout.addChild(this.viewpager);
        absoluteLayout.addChild(this.barContainer);
    };
    ViewPagerComponent.prototype.ngOnDestroy = function () {
        this.subscribe.unsubscribe();
    };
    ViewPagerComponent.prototype.flip = function (index) {
        var _this = this;
        if (this.index === this.images.length - 1) {
            index = 0;
        }
        this.viewpager.animate({
            translate: { x: -platform_1.screen.mainScreen.widthDIPs * index, y: 0 },
            duration: 300,
            curve: enums_1.AnimationCurve.linear,
        }).then(function () {
            if (_this.index === _this.images.length - 1) {
                _this.index = 0;
            }
            else {
                _this.index++;
            }
            for (var i = 0; i < _this.barContainer.getChildrenCount(); i++) {
                var lab = _this.barContainer.getChildAt(i);
                if (_this.index === i) {
                    lab.set("backgroundColor", "#ffffff");
                }
                else {
                    lab.set("backgroundColor", "#55000000");
                }
            }
        });
    };
    ViewPagerComponent.prototype.upFlip = function (index) {
        var _this = this;
        if (index === -1) {
            index = this.images.length - 1;
        }
        this.viewpager.animate({
            translate: { x: -platform_1.screen.mainScreen.widthDIPs * index, y: 0 },
            duration: 300,
            curve: enums_1.AnimationCurve.linear,
        }).then(function () {
            if (_this.index === 0) {
                _this.index = _this.images.length - 1;
            }
            else {
                _this.index--;
            }
            for (var i = 0; i < _this.barContainer.getChildrenCount(); i++) {
                var lab = _this.barContainer.getChildAt(i);
                if (_this.index === i) {
                    lab.set("backgroundColor", "#ffffff");
                }
                else {
                    lab.set("backgroundColor", "#55000000");
                }
            }
        });
    };
    ViewPagerComponent.prototype.onTap = function () {
        this.onPagerChange.emit(this.index);
    };
    ViewPagerComponent.prototype.onPan = function (args) {
        var _this = this;
        // this.viewpager.set("translateX",-screen.mainScreen.widthDIPs * (this.index + 1)+args.deltaX)
        if (args.state === 1) {
            this.subscribe.unsubscribe();
        }
        else if (args.state === 3) {
            if (args.deltaX > 20) {
                this.upFlip(this.index - 1);
            }
            else if (args.deltaX < -20) {
                this.flip(this.index + 1);
            }
            this.subscribe = Observable_1.Observable.interval(2500).subscribe(function (time) {
                _this.flip(_this.index + 1);
            });
        }
    };
    return ViewPagerComponent;
}());
__decorate([
    core_1.ViewChild("container"),
    __metadata("design:type", core_1.ElementRef)
], ViewPagerComponent.prototype, "container", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Array)
], ViewPagerComponent.prototype, "images", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], ViewPagerComponent.prototype, "onPagerChange", void 0);
ViewPagerComponent = __decorate([
    core_1.Component({
        selector: "view-pager",
        moduleId: module.id,
        templateUrl: "./view-pager.component.html",
        styleUrls: ["./view-pager.common.css"],
    })
], ViewPagerComponent);
exports.ViewPagerComponent = ViewPagerComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy1wYWdlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ2aWV3LXBhZ2VyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7R0FFRzs7O0FBRUgsc0NBR3VCO0FBQ3ZCLHlFQUFxRTtBQUNyRSxtREFBZ0Q7QUFFaEQsOENBQTJDO0FBQzNDLHFDQUFnQztBQUVoQyxtREFBeUQ7QUFTekQsSUFBYSxrQkFBa0I7SUFQL0I7UUFZb0Isa0JBQWEsR0FBRyxJQUFJLG1CQUFZLEVBQUUsQ0FBQztRQUc3QyxVQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsV0FBTSxHQUFXLENBQUMsQ0FBQztJQXNIN0IsQ0FBQztJQXBIUSxxQ0FBUSxHQUFmO1FBQUEsaUJBS0M7UUFKQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsU0FBUyxHQUFHLHVCQUFVLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUNuRCxLQUFJLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0sb0NBQU8sR0FBZCxVQUFlLE1BQWdCO1FBQS9CLGlCQWtDQztRQWpDQyxJQUFJLENBQUMsTUFBTSxHQUFHLGlCQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDO1FBQ3ZELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSwwQkFBVyxFQUFFLENBQUM7UUFDbkMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLGlCQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzlFLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFB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REFBQztBQUU3QztJQUFSLFlBQUssRUFBRTs7a0RBQTBCO0FBQ3hCO0lBQVQsYUFBTSxFQUFFOzt5REFBNEM7QUFMMUMsa0JBQWtCO0lBUDlCLGdCQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsWUFBWTtRQUN0QixRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7UUFDbkIsV0FBVyxFQUFFLDZCQUE2QjtRQUMxQyxTQUFTLEVBQUUsQ0FBQyx5QkFBeUIsQ0FBQztLQUN2QyxDQUFDO0dBRVcsa0JBQWtCLENBK0g5QjtBQS9IWSxnREFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgYWRtaW4gb24gMjAxNy82LzEyLlxuICovXG5cbmltcG9ydCB7XG4gIENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgVmlld0NoaWxkLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgRWxlbWVudFJlZixcbiAgT25EZXN0cm95XG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQge1N0YWNrTGF5b3V0fSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9sYXlvdXRzL3N0YWNrLWxheW91dFwiO1xuaW1wb3J0IHtJbWFnZX0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvaW1hZ2VcIjtcbmltcG9ydCB7U3Vic2NyaXB0aW9ufSBmcm9tIFwicnhqcy9TdWJzY3JpcHRpb25cIjtcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSBcInJ4anMvT2JzZXJ2YWJsZVwiO1xuaW1wb3J0IHtzY3JlZW59IGZyb20gXCJwbGF0Zm9ybVwiO1xuaW1wb3J0IHtQYW5HZXN0dXJlRXZlbnREYXRhfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9nZXN0dXJlc1wiO1xuaW1wb3J0IHtBbmltYXRpb25DdXJ2ZX0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvZW51bXNcIjtcbmltcG9ydCB7QWJzb2x1dGVMYXlvdXR9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2xheW91dHMvYWJzb2x1dGUtbGF5b3V0XCI7XG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwidmlldy1wYWdlclwiLFxuICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXctcGFnZXIuY29tcG9uZW50Lmh0bWxcIixcbiAgc3R5bGVVcmxzOiBbXCIuL3ZpZXctcGFnZXIuY29tbW9uLmNzc1wiXSxcbn0pXG5cbmV4cG9ydCBjbGFzcyBWaWV3UGFnZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgYmFyQ29udGFpbmVyOiBTdGFja0xheW91dDtcbiAgQFZpZXdDaGlsZChcImNvbnRhaW5lclwiKSBwcml2YXRlIGNvbnRhaW5lcjogRWxlbWVudFJlZjtcblxuICBASW5wdXQoKSBwcml2YXRlIGltYWdlczogc3RyaW5nW107XG4gIEBPdXRwdXQoKSBwcml2YXRlIG9uUGFnZXJDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIHByaXZhdGUgdmlld3BhZ2VyOiBTdGFja0xheW91dDtcbiAgcHJpdmF0ZSBzdWJzY3JpYmU6IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBpbmRleCA9IDA7XG4gIHByaXZhdGUgaGVpZ2h0OiBudW1iZXIgPSAwO1xuXG4gIHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmFkZERhdGEodGhpcy5pbWFnZXMpO1xuICAgIHRoaXMuc3Vic2NyaWJlID0gT2JzZXJ2YWJsZS5pbnRlcnZhbCgyNTAwKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5mbGlwKHRoaXMuaW5kZXggKyAxKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBhZGREYXRhKGltYWdlczogc3RyaW5nW10pIHtcbiAgICB0aGlzLmhlaWdodCA9IHNjcmVlbi5tYWluU2NyZWVuLndpZHRoRElQcyAqIDUyMCAvIDEwODA7XG4gICAgdGhpcy52aWV3cGFnZXIgPSBuZXcgU3RhY2tMYXlvdXQoKTtcbiAgICB0aGlzLnZpZXdwYWdlci5zZXQoXCJ3aWR0aFwiLCBzY3JlZW4ubWFpblNjcmVlbi53aWR0aERJUHMgKiB0aGlzLmltYWdlcy5sZW5ndGgpO1xuICAgIHRoaXMudmlld3BhZ2VyLnNldChcImhlaWdodFwiLCB0aGlzLmhlaWdodCk7XG4gICAgdGhpcy52aWV3cGFnZXIuc2V0KFwib3JpZW50YXRpb25cIiwgXCJob3Jpem9udGFsXCIpO1xuICAgIHRoaXMuYmFyQ29udGFpbmVyID0gbmV3IFN0YWNrTGF5b3V0KCk7XG4gICAgdGhpcy5iYXJDb250YWluZXIuc2V0KFwid2lkdGhcIiwgMjAgKiBpbWFnZXMubGVuZ3RoKTtcbiAgICB0aGlzLmJhckNvbnRhaW5lci5zZXQoXCJoZWlnaHRcIiwgMjApO1xuICAgIHRoaXMuYmFyQ29udGFpbmVyLnNldChcIm9yaWVudGF0aW9uXCIsIFwiaG9yaXpvbnRhbFwiKTtcbiAgICB0aGlzLmJhckNvbnRhaW5lci5zZXQoXCJsZWZ0XCIsIChzY3JlZW4ubWFpblNjcmVlbi53aWR0aERJUHMgLSAyMCAqIGltYWdlcy5sZW5ndGgpIC8gMik7XG4gICAgdGhpcy5iYXJDb250YWluZXIuc2V0KFwidG9wXCIsIHRoaXMuaGVpZ2h0IC0gMzApO1xuICAgIGltYWdlcy5mb3JFYWNoKCh1cmwsIGkpID0+IHtcbiAgICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICBpbWFnZS5zZXQoXCJzcmNcIiwgdXJsKTtcbiAgICAgIGltYWdlLnNldChcIndpZHRoXCIsIHNjcmVlbi5tYWluU2NyZWVuLndpZHRoRElQcyk7XG4gICAgICBpbWFnZS5zZXQoXCJoZWlnaHRcIiwgdGhpcy5oZWlnaHQpO1xuICAgICAgdGhpcy52aWV3cGFnZXIuYWRkQ2hpbGQoaW1hZ2UpO1xuXG4gICAgICBjb25zdCBsYWIgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIGxhYi5zZXQoXCJ3aWR0aFwiLCAxMCk7XG4gICAgICBsYWIuc2V0KFwiaGVpZ2h0XCIsIDEwKTtcbiAgICAgIGxhYi5zZXQoXCJib3JkZXJSYWRpdXNcIiwgMTApO1xuICAgICAgbGFiLnNldChcIm1hcmdpblwiLCA1KTtcbiAgICAgIGlmIChpID09PSAwKSB7XG4gICAgICAgIGxhYi5zZXQoXCJiYWNrZ3JvdW5kQ29sb3JcIiwgXCIjZmZmZmZmXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGFiLnNldChcImJhY2tncm91bmRDb2xvclwiLCBcIiM0NDAwMDAwMFwiKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuYmFyQ29udGFpbmVyLmFkZENoaWxkKGxhYik7XG4gICAgfSk7XG4gICAgY29uc3QgYWJzb2x1dGVMYXlvdXQgPSB0aGlzLmNvbnRhaW5lci5uYXRpdmVFbGVtZW50IGFzIEFic29sdXRlTGF5b3V0O1xuICAgIGFic29sdXRlTGF5b3V0LmFkZENoaWxkKHRoaXMudmlld3BhZ2VyKTtcbiAgICBhYnNvbHV0ZUxheW91dC5hZGRDaGlsZCh0aGlzLmJhckNvbnRhaW5lcik7XG4gIH1cblxuICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5zdWJzY3JpYmUudW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIHB1YmxpYyBmbGlwKGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5pbmRleCA9PT0gdGhpcy5pbWFnZXMubGVuZ3RoIC0gMSkge1xuICAgICAgaW5kZXggPSAwO1xuICAgIH1cbiAgICB0aGlzLnZpZXdwYWdlci5hbmltYXRlKHtcbiAgICAgIHRyYW5zbGF0ZToge3g6IC1zY3JlZW4ubWFpblNjcmVlbi53aWR0aERJUHMgKiBpbmRleCwgeTogMH0sXG4gICAgICBkdXJhdGlvbjogMzAwLFxuICAgICAgY3VydmU6IEFuaW1hdGlvbkN1cnZlLmxpbmVhcixcbiAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmluZGV4ID09PSB0aGlzLmltYWdlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5pbmRleCsrO1xuICAgICAgfVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJhckNvbnRhaW5lci5nZXRDaGlsZHJlbkNvdW50KCk7IGkrKykge1xuICAgICAgICBjb25zdCBsYWIgPSB0aGlzLmJhckNvbnRhaW5lci5nZXRDaGlsZEF0KGkpO1xuICAgICAgICBpZiAodGhpcy5pbmRleCA9PT0gaSkge1xuICAgICAgICAgIGxhYi5zZXQoXCJiYWNrZ3JvdW5kQ29sb3JcIiwgXCIjZmZmZmZmXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxhYi5zZXQoXCJiYWNrZ3JvdW5kQ29sb3JcIiwgXCIjNTUwMDAwMDBcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyB1cEZsaXAoaW5kZXg6IG51bWJlcikge1xuICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgIGluZGV4ID0gdGhpcy5pbWFnZXMubGVuZ3RoIC0gMTtcbiAgICB9XG4gICAgdGhpcy52aWV3cGFnZXIuYW5pbWF0ZSh7XG4gICAgICB0cmFuc2xhdGU6IHt4OiAtc2NyZWVuLm1haW5TY3JlZW4ud2lkdGhESVBzICogaW5kZXgsIHk6IDB9LFxuICAgICAgZHVyYXRpb246IDMwMCxcbiAgICAgIGN1cnZlOiBBbmltYXRpb25DdXJ2ZS5saW5lYXIsXG4gICAgfSkudGhlbigoKSA9PiB7XG4gICAgICBpZiAodGhpcy5pbmRleCA9PT0gMCkge1xuICAgICAgICB0aGlzLmluZGV4ID0gdGhpcy5pbWFnZXMubGVuZ3RoIC0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaW5kZXgtLTtcbiAgICAgIH1cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5iYXJDb250YWluZXIuZ2V0Q2hpbGRyZW5Db3VudCgpOyBpKyspIHtcbiAgICAgICAgY29uc3QgbGFiID0gdGhpcy5iYXJDb250YWluZXIuZ2V0Q2hpbGRBdChpKTtcbiAgICAgICAgaWYgKHRoaXMuaW5kZXggPT09IGkpIHtcbiAgICAgICAgICBsYWIuc2V0KFwiYmFja2dyb3VuZENvbG9yXCIsIFwiI2ZmZmZmZlwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsYWIuc2V0KFwiYmFja2dyb3VuZENvbG9yXCIsIFwiIzU1MDAwMDAwXCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgb25UYXAoKSB7XG4gICAgdGhpcy5vblBhZ2VyQ2hhbmdlLmVtaXQodGhpcy5pbmRleCk7XG4gIH1cblxuICBwdWJsaWMgb25QYW4oYXJnczogUGFuR2VzdHVyZUV2ZW50RGF0YSkge1xuICAgIC8vIHRoaXMudmlld3BhZ2VyLnNldChcInRyYW5zbGF0ZVhcIiwtc2NyZWVuLm1haW5TY3JlZW4ud2lkdGhESVBzICogKHRoaXMuaW5kZXggKyAxKSthcmdzLmRlbHRhWClcbiAgICBpZiAoYXJncy5zdGF0ZSA9PT0gMSkge1xuICAgICAgdGhpcy5zdWJzY3JpYmUudW5zdWJzY3JpYmUoKTtcbiAgICB9IGVsc2UgaWYgKGFyZ3Muc3RhdGUgPT09IDMpIHtcbiAgICAgIGlmIChhcmdzLmRlbHRhWCA+IDIwKSB7XG4gICAgICAgIHRoaXMudXBGbGlwKHRoaXMuaW5kZXggLSAxKTtcbiAgICAgIH0gZWxzZSBpZiAoYXJncy5kZWx0YVggPCAtMjApIHtcbiAgICAgICAgdGhpcy5mbGlwKHRoaXMuaW5kZXggKyAxKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc3Vic2NyaWJlID0gT2JzZXJ2YWJsZS5pbnRlcnZhbCgyNTAwKS5zdWJzY3JpYmUoKHRpbWUpID0+IHtcbiAgICAgICAgdGhpcy5mbGlwKHRoaXMuaW5kZXggKyAxKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIl19